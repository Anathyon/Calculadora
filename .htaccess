# ========================================
# CALCULADORA PWA - HTACCESS OTIMIZADO
# Performance + Segurança
# ========================================

# COMPRESSÃO GZIP
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/manifest+json
</IfModule>

# CACHE BROWSER - PERFORMANCE
<IfModule mod_expires.c>
    ExpiresActive On
    
    # HTML (1 hora)
    ExpiresByType text/html "access plus 1 hour"
    
    # CSS e JS (1 mês)
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    
    # Imagens (6 meses)
    ExpiresByType image/png "access plus 6 months"
    ExpiresByType image/jpg "access plus 6 months"
    ExpiresByType image/jpeg "access plus 6 months"
    ExpiresByType image/gif "access plus 6 months"
    ExpiresByType image/svg+xml "access plus 6 months"
    ExpiresByType image/webp "access plus 6 months"
    
    # PWA Files (1 mês)
    ExpiresByType application/manifest+json "access plus 1 month"
    
    # Service Worker (sem cache)
    <Files "sw.js">
        ExpiresDefault "access plus 0 seconds"
    </Files>
</IfModule>

# HEADERS DE CACHE
<IfModule mod_headers.c>
    # CSS e JS
    <FilesMatch "\.(css|js)$">
        Header set Cache-Control "public, max-age=2592000"
    </FilesMatch>
    
    # Imagens
    <FilesMatch "\.(png|jpg|jpeg|gif|svg|webp|ico)$">
        Header set Cache-Control "public, max-age=15552000"
    </FilesMatch>
    
    # Service Worker sem cache
    <Files "sw.js">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
    </Files>
</IfModule>

# ========================================
# SEGURANÇA CONTRA HACKERS
# ========================================

# HEADERS DE SEGURANÇA
<IfModule mod_headers.c>
    # Previne XSS
    Header always set X-XSS-Protection "1; mode=block"
    
    # Previne MIME sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # Clickjacking protection
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # HTTPS Strict Transport Security
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
    # Content Security Policy
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'"
    
    # Remove server info
    Header always unset Server
    Header always unset X-Powered-By
</IfModule>

# BLOQUEAR ACESSO A ARQUIVOS SENSÍVEIS
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|inc|bak)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# BLOQUEAR BOTS MALICIOSOS
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Bloquear user agents suspeitos
    RewriteCond %{HTTP_USER_AGENT} (nikto|sqlmap|fimap|nessus|openvas|nmap) [NC]
    RewriteRule .* - [F,L]
    
    # Bloquear tentativas de SQL injection
    RewriteCond %{QUERY_STRING} (union.*select|insert.*into|delete.*from) [NC]
    RewriteRule .* - [F,L]
    
    # Bloquear tentativas XSS
    RewriteCond %{QUERY_STRING} (<script|javascript:|vbscript:) [NC]
    RewriteRule .* - [F,L]
</IfModule>

# LIMITAR TAMANHO DE UPLOAD
LimitRequestBody 10485760

# DESABILITAR DIRECTORY BROWSING
Options -Indexes

# FORÇA HTTPS (se disponível)
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>